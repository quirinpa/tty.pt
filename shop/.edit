#!/bin/sh

lsshown() {
	 find $1 -type d -mindepth 1 -maxdepth 1 -name "[!.]*" | sed "s|$1||" | sed "s/\/$//"
}

Products() {
	local product_id
	while read product_id; do
		if test "`cat $SHOP_PATH/$product_id/stock`" -gt 0; then
			product_env $product_id
			cat <<!
<label class="card f v8 b0 fic p">
	`PImage $product_image_path`
	<div class="tsl">$product_priceâ‚¬</div>
	<a class="tsxl" href="./../$product_id/">$product_title</a>
	`echo "$product_description" | csurround p`
	<input name="delete_$product_id" type="checkbox"></input>
</label>
!
		fi
	done
}

content() {
	lsshown $(pwd)/$shop_id/ | Products | fw
}

fun() {
	test -z "$REMOTE_USER" && return

	cat <<!
<a class="$RB" href="./../order/">ðŸšš</a>
<a class="$RB" href="./../cart">ðŸ›’</a>
!
	if im $SHOP_OWNER; then
		cat <<!
<a class="$RB" href="./../add/">+</a>
!
	fi
}

# lsshown $SHOP_PATH/ | while read product_id; do
# qname=delete_$product_id
# eval echo $product_id \$$qname
# done | while read product_id state; do
# 	test "$state" != "on" || product_rm $product_id
# done

# _see_other .
_TITLE="`_ $shop_id` - `_ "Edit shop"`"
BOTTOM_CONTENT="<button>`_ "Delete Products"`</button>"
SubIndex
Forbidden
